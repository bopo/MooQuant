

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>更新记录 &mdash; MooQuant 0.2.1 文档</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="索引"
              href="genindex.html"/>
        <link rel="search" title="搜索" href="search.html"/>
    <link rel="top" title="MooQuant 0.2.1 文档" href="index.html"/>
        <link rel="prev" title="扩展数据源" href="development/data_source.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> MooQuant
          

          
          </a>

          
            
            
              <div class="version">
                0.2.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">基础</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro/overview.html">基本介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/install.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/tutorial.html">入门教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/examples.html">策略示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/detail_install.html">环境搭建</a></li>
</ul>
<p class="caption"><span class="caption-text">进阶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro/run_algorithm.html">多种方式运行策略</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/under_ide.html">通过 PyCharm 运行/调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro/optimizing_parameters.html">参数调优</a></li>
</ul>
<p class="caption"><span class="caption-text">开发</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development/make_contribute.html">如何贡献代码</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/basic_concept.html">基本概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/event_source.html">扩展事件源</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/data_source.html">扩展数据源</a></li>
</ul>
<p class="caption"><span class="caption-text">其他</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">更新记录</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">3.0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">3.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">3.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">2.2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">2.2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">2.2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">2.2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">2.1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id13">2.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">2.1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">2.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id16">2.0.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id17">2.0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id18">2.0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id19">2.0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id20">2.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id21">2.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id24">0.3.14</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id25">0.3.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id26">0.3.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id27">0.3.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id28">0.3.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id29">0.3.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id30">0.3.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id31">0.3.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id32">0.3.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id33">0.3.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id34">0.3.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id35">0.3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id36">0.3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id37">0.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id38">0.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id39">0.0.53</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id40">0.0.20</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id41">0.0.19</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id42">0.0.18</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id43">0.0.16</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id44">0.0.15</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id45">0.0.14</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id46">0.0.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id47">0.0.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id48">0.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id49">0.0.1</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MooQuant</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>更新记录</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/history.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="history">
<span id="id1"></span><h1>更新记录<a class="headerlink" href="#history" title="永久链接至标题">¶</a></h1>
<div class="section" id="id2">
<h2>3.0.6<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>import 修改相对引用为绝对引用</li>
<li>重构配置文件读取功能，分为默认配置，用户配置，项目配置</li>
<li>重构 <cite>main()</cite> 的 <cite>tear_down</cite> 的调用</li>
<li>get_previous_trading_date(date, n=1) 增加参数 n</li>
<li>增加公募基金数据处理相关逻辑</li>
<li>修改 <cite>mod.tear_down</cite> ，如果单个 mod 在 tear_down 抛异常后，不影响其他 mod 继续 tear_down</li>
<li>scheduler bugfix</li>
<li>处理 persist 遇到的异常</li>
<li>修复 order get_state / set_state 缺失 transaction_cost, avg_price</li>
<li>修复 mod_sys_stock_realtime</li>
</ul>
</div>
<div class="section" id="id3">
<h2>3.0.2<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>取消在股票下单函数中对 <cite>order_book_id</cite> 类型的检查，现在您可以交易 <cite>ETF</cite>, <cite>LOF</cite>, <cite>FenjiMu</cite>, <cite>FenjiA</cite>, <cite>FenjiB</cite>, <cite>INDX</cite> 了</li>
<li>Merge <a class="reference external" href="https://github.com/ricequant/rqalpha/pull/170">PR 170</a> 解决自定义 <cite>volume limit</cite> 时显示数值不正确的问题。</li>
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/148">Issue 148</a> <cite>get_dividend()方法返回的类型是numpy.ndarray，而非pandas.DataFrame</cite></li>
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/169">Issue 169</a> 执行 <cite>rqalpha mod install ctp==0.2.0dev0</cite> 时错误的记录了库信息的问题</li>
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/158">Issue 158</a> 多次循环 <cite>run_file</cite> / <cite>run_code</cite> 时导致的内存泄漏的问题</li>
<li>Enhance <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/166">Issue 166</a> 启动参数支持 <cite>–no-stock-t1</cite> 来屏蔽股票 T + 1 导致今仓的限制</li>
<li>性能提升: 使用 <cite>bisect_right</cite> 代替 <cite>searchsorted</cite></li>
</ul>
</div>
<div class="section" id="id4">
<h2>3.0.0<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p><strong>[For 开发/运行策略的用户]</strong></p>
<p>3.x 相比 2.x 进行了如下更改，如果您升级到 3.x 版本，请务必阅读以下内容，保证您的策略可以顺利启动和执行:</p>
<ul class="simple">
<li>命令行参数做出如下调整<ul>
<li>不再使用 <code class="code docutils literal"><span class="pre">-sc/--stock-starting-cash</span></code> 参数</li>
<li>不再使用 <code class="code docutils literal"><span class="pre">-fc/--future-starting-cash</span></code> 参数</li>
<li>不再使用 <code class="code docutils literal"><span class="pre">-i/--init-cash</span></code> 参数</li>
<li>不再使用 <code class="code docutils literal"><span class="pre">-s/--security</span></code> 参数</li>
<li>不再使用 <code class="code docutils literal"><span class="pre">-k/--kind</span></code> 参数</li>
<li>不再使用 <code class="code docutils literal"><span class="pre">--strategy-type</span></code> 参数</li>
<li><strong>使用</strong> <code class="code docutils literal"><span class="pre">--account</span></code> 来替代，具体用法如下</li>
</ul>
</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 策略通过命令行运行，设置可交易类型是股票，起始资金为 10000</span>
$ rqalpha run --account stock <span class="m">10000</span>
<span class="c1"># 策略通过命令行运行，设置可交易类型为期货，起始资金为 50000</span>
$ rqalpha run --account future <span class="m">50000</span>
<span class="c1"># 策略通过命令行运行，设置可交易类型为期货和股票，起始资金分别为 股票 10000, 期货 50000</span>
$ rqalpha run --account stock <span class="m">10000</span> --account future <span class="m">50000</span>
<span class="c1"># 如果您通过 Mod 扩展，自定义了一种可交易类型(假设是huobi)，您也可以增加对于火币的支持和起始资金设置</span>
$ rqalpha run --account stock <span class="m">10000</span> --account future <span class="m">50000</span> --account huobi <span class="m">20000</span>
</pre></div>
</div>
<ul class="simple">
<li>相应，如果您通过 <code class="code docutils literal"><span class="pre">run_file</span> <span class="pre">|</span> <span class="pre">run_code</span> <span class="pre">|</span> <span class="pre">run_func</span></code> 来启动策略，配置文件及配置信息也做了对应的调整:<ul>
<li>不再使用 <code class="code docutils literal"><span class="pre">base.stock_starting_cash</span></code></li>
<li>不再使用 <code class="code docutils literal"><span class="pre">base.future_starting_cash</span></code></li>
<li>不再使用 <code class="code docutils literal"><span class="pre">base.securities</span></code></li>
<li><strong>使用</strong> <code class="code docutils literal"><span class="pre">base.accounts</span></code> 来替代，具体用法如下:</li>
</ul>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># 策略通过配置，设置可交易类型是股票，起始资金为 10000</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matching_type&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;stock&quot;</span><span class="p">:</span> <span class="mi">10000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># 策略通过配置，设置可交易类型是期货，起始资金为 50000</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matching_type&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="mi">50000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># 策略通过配置，设置可交易类型为期货和股票，起始资金分别为 股票 10000, 期货 50000</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matching_type&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;stock&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
      <span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="mi">50000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># 如果您通过 Mod 扩展，自定义了一种可交易类型(假设是huobi)，您也可以增加对于火币的支持和起始资金设置</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matching_type&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;stock&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
      <span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
      <span class="s2">&quot;huobi&quot;</span><span class="p">:</span> <span class="mi">20000</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>[For Mod developer]</strong></p>
<p>本次更新可能导致已实现 Mod 无法正常使用，请按照文档升级您的 Mod，或者使用 2.2.x 版本 RQAlpha</p>
<p>在通过 Mod 扩展 RQAlpha 的时候，由于 RQAlpha 直接定义了 <cite>Account</cite> 和 <cite>Position</cite> 相关的 Model, 增加新的 <cite>account</cite> 和 <cite>position</cite> 变得非常的困难，想扩展更多类型是一件很麻烦的事情，因此我们决定重构该模块从而解决这些问题。</p>
<p>详情请查看: <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/160">https://github.com/ricequant/rqalpha/issues/160</a></p>
<p>主要进行如下更改:</p>
<ul class="simple">
<li>增加 <code class="code docutils literal"><span class="pre">AbstractAccount</span></code> 和 <code class="code docutils literal"><span class="pre">AbstractPosition</span></code>, 用户可以基于该抽象类进行扩展。</li>
<li><code class="code docutils literal"><span class="pre">const.ACCOUNT_TYPE</span></code> 修改为 <code class="code docutils literal"><span class="pre">const.DEFAULT_ACCOUNT_TYPE</span></code>，并且不再直接使用，您可以通过 <code class="code docutils literal"><span class="pre">Environment.get_instance().account_type_dict</span></code> 来获取包括 Mod 注入的账户类型。</li>
<li>原先所有使用 <cite>ACCOUNT_TYPE</cite> 作为 key 的地方，不再使用 Enum 类型作为 Key, 而是修改为对应 Enum 的 name 作为key。比如说原本使用 <code class="code docutils literal"><span class="pre">portfolio.accounts[ACCOUNT_TYPE.STOCK]</span></code> 更改为 <code class="code docutils literal"><span class="pre">portfolio.accounts['STOCK']</span></code></li>
<li><code class="code docutils literal"><span class="pre">Environment</span></code> 提供 <code class="code docutils literal"><span class="pre">set_account_model</span></code> | <code class="code docutils literal"><span class="pre">get_account_model</span></code> | <code class="code docutils literal"><span class="pre">set_position_model</span></code> | <code class="code docutils literal"><span class="pre">get_position_model</span></code> API 来注入 自定义Model。</li>
<li><code class="code docutils literal"><span class="pre">Environment</span></code> 提供 <code class="code docutils literal"><span class="pre">set_smart_order</span></code> API 来注入自定义账户类型的智能下单函数，从而通过通用的 <code class="code docutils literal"><span class="pre">order</span></code> | <code class="code docutils literal"><span class="pre">order_to</span></code> API 便可以交易对应自定义账户类型。</li>
<li>RQAlpha 将已有的 AccountModel, PositionModel 和 API 抽离至 <cite>rqalpha_mod_sys_accounts</cite> 中，通过如下方式注入:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.account_model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.position_model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">api_future</span><span class="p">,</span> <span class="n">api_stock</span>


<span class="k">class</span> <span class="nc">AccountMod</span><span class="p">(</span><span class="n">AbstractMod</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">start_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">mod_config</span><span class="p">):</span>

        <span class="c1"># 注入 Account</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_account_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">STOCK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">StockAccount</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_account_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">FUTURE</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">FutureAccount</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_account_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">BENCHMARK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">BenchmarkAccount</span><span class="p">)</span>

        <span class="c1"># 注入 Position</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_position_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">STOCK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">StockPosition</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_position_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">FUTURE</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">FuturePosition</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set_position_model</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">BENCHMARK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">StockPosition</span><span class="p">)</span>

        <span class="c1"># 注入 API</span>
        <span class="k">if</span> <span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">FUTURE</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">accounts</span><span class="p">:</span>
            <span class="c1"># 注入期货API</span>
            <span class="k">for</span> <span class="n">export_name</span> <span class="ow">in</span> <span class="n">api_future</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
                <span class="n">export_as_api</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">api_future</span><span class="p">,</span> <span class="n">export_name</span><span class="p">))</span>
            <span class="c1"># 注入 smart order</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_smart_order</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">FUTURE</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">api_future</span><span class="o">.</span><span class="n">smart_order</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">STOCK</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">accounts</span><span class="p">:</span>
            <span class="c1"># 注入股票API</span>
            <span class="k">for</span> <span class="n">export_name</span> <span class="ow">in</span> <span class="n">api_stock</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
                <span class="n">export_as_api</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">api_stock</span><span class="p">,</span> <span class="n">export_name</span><span class="p">))</span>
            <span class="c1"># 注入 smart order</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_smart_order</span><span class="p">(</span><span class="n">DEFAULT_ACCOUNT_TYPE</span><span class="o">.</span><span class="n">STOCK</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">api_stock</span><span class="o">.</span><span class="n">smart_order</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tear_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>2.2.7<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>解决当存在无效 Mod 时，RQAlpha 崩溃无法启动的问题</li>
<li>修复期货下单函数默认 style 为 None 导致报错退出的问题</li>
</ul>
</div>
<div class="section" id="id6">
<h2>2.2.5<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加 IPython Magic 方便在 IPython 中运行回测 <a class="reference external" href="https://github.com/ricequant/rqalpha/blob/master/docs/source/notebooks/run-rqalpha-in-ipython.ipynb">run-rqalpha-in-ipython.ipynb</a> 。运行完回测后，会将所有的 mod 的输出结果保存在 results 变量中，并且会将回测报告存储在 report 对象中。</li>
<li>修复系统异常、用户异常的区分判断</li>
<li>增加 <code class="code docutils literal"><span class="pre">--source-code</span></code> 参数可以直接在命令行中传入策略源代码进行回测，这个选项目前主要给 IPython 使用。</li>
<li>对于 <code class="code docutils literal"><span class="pre">history_bars</span></code> 当 fields 为 None 的时候，指定为 [“datetime”, “open”, “high”, “low”, “close”, “volume”] 。</li>
<li>重构 rqalpha_mod_sys_funcat 的数据获取</li>
<li>修复 order 的 set_state 的 bug</li>
<li>优化分红计算</li>
<li>提取 inject_mod_commands 给 click 参数注入</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># 加载 rqalpha 插件</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">rqalpha</span>

<span class="c1"># 运行回测</span>
<span class="o">%%</span> <span class="n">rqalpha</span> <span class="o">-</span><span class="n">s</span> <span class="mi">20160101</span> <span class="o">-</span><span class="n">e</span> <span class="mi">20170101</span> <span class="o">-</span><span class="n">sc</span> <span class="mi">100000</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2>2.2.4<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>所有的下单函数进行了扩展，扩展如下:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># 以 order_shares 举例，其他的下单函数同理。</span>
<span class="c1"># 原本的下单方式: 以 200 元的价格下单 100 股 000001.XSHE</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">LimitOrder</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="c1"># 下单的如下方式都OK:</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">LimitOrder</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">order_shares</span><span class="p">(</span><span class="s2">&quot;000001.XSHE&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">LimitOrder</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="code docutils literal"><span class="pre">buy_close</span></code> 和 <code class="code docutils literal"><span class="pre">sell_close</span></code> API 增加 <code class="code docutils literal"><span class="pre">close_today</span></code> 参数，现在您现在可以指定发平今单了。</li>
<li>Breaking Change: 原本期货中的 <code class="code docutils literal"><span class="pre">buy_close</span></code> 和 <code class="code docutils literal"><span class="pre">sell_close</span></code> API 返回的 <code class="code docutils literal"><span class="pre">Order</span></code> 对象。但实际交易过程中，涉及到昨仓今仓的时候，可能会存在发单被拒单的情况，RQAlpha 进行平昨/平今智能拆单的处理，因此在一些情况下会生成多个订单，对应也会返回一个订单列表。期货平仓更新的内容请参考 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/116">Issue 116</a></li>
<li>Breaking Change: 取消 <code class="code docutils literal"><span class="pre">Order</span></code> | <code class="code docutils literal"><span class="pre">Trade</span></code> 对应的 <code class="code docutils literal"><span class="pre">__from_create__</span></code> 函数中 <code class="code docutils literal"><span class="pre">calendar_dt</span></code> 和 <code class="code docutils literal"><span class="pre">trading_dt</span></code> 的传入，对接第三方交易源，构建订单和成交的 Mod 可能会产生影响，需要进行修改.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># 原先的构建方式</span>
<span class="n">Order</span><span class="o">.</span><span class="n">__from_create__</span><span class="p">(</span>
  <span class="n">calendar_dt</span><span class="p">,</span>
  <span class="n">trading_dt</span><span class="p">,</span>
  <span class="n">order_book_id</span><span class="p">,</span>
  <span class="n">amount</span><span class="p">,</span>
  <span class="n">side</span><span class="p">,</span>
  <span class="n">style</span><span class="p">,</span>
  <span class="n">position_effect</span>
<span class="p">)</span>
<span class="c1">#修改为</span>
<span class="n">Order</span><span class="o">.</span><span class="n">__from_create__</span><span class="p">(</span>
  <span class="n">order_book_id</span><span class="p">,</span>
  <span class="n">amount</span><span class="p">,</span>
  <span class="n">side</span><span class="p">,</span>
  <span class="n">style</span><span class="p">,</span>
  <span class="n">position_effect</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><cite>iPython</cite> 更新至 6.0 版本以后不再支持 <cite>Python 2.x</cite> 导致在 <cite>Python 2.x</cite> 下安装RQAlpha 因为 <cite>line-profiler</cite> 依赖 <cite>iPython</cite> 的缘故而报错。目前增加了在 <cite>Python 2.x</cite> 下依赖 <cite>iPython 5.3.0</cite> 版本解决此问题。</li>
<li>不再提供 <cite>rqalpha-cmd</cite> 命令的扩展和注入，目前只有一个 entry point: <cite>rqalpha</cite> 第三方 Mod 可以扩展 <cite>rqalpha</cite> 命令。</li>
<li>增加 <code class="code docutils literal"><span class="pre">from</span> <span class="pre">rqalpha</span> <span class="pre">import</span> <span class="pre">subscribe_event</span></code> 来支持事件订阅(暂时不增加到API中，您如果想在策略里使用，也需要主动 import 该函数), 如下示例所示:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rqalpha.api</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">rqalpha</span> <span class="kn">import</span> <span class="n">subscribe_event</span>


<span class="k">def</span> <span class="nf">on_trade_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">trade</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">trade</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">order</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">account</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Trade Handler&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">trade</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_order_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">order</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;Order Handler&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="s2">&quot;000001.XSHE&quot;</span>
    <span class="n">update_universe</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">s1</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">fired</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">subscribe_event</span><span class="p">(</span><span class="n">EVENT</span><span class="o">.</span><span class="n">TRADE</span><span class="p">,</span> <span class="n">on_trade_handler</span><span class="p">)</span>
    <span class="n">subscribe_event</span><span class="p">(</span><span class="n">EVENT</span><span class="o">.</span><span class="n">ORDER_CREATION_PASS</span><span class="p">,</span> <span class="n">on_order_handler</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">before_trading</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">handle_bar</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">bar_dict</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">fired</span><span class="p">:</span>
        <span class="n">order_percent</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">s1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">fired</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># rqalpha run -f ./rqalpha/examples/subscribe_event.py -s 2016-06-01 -e 2016-12-01 --stock-starting-cash 100000 --benchmark 000300.XSHG</span>
</pre></div>
</div>
<ul class="simple">
<li><cite>sys_stock_realtime</cite> 提供了一个行情下载服务，启动该服务，会实时往 redis 中写入全市场股票行情数据。多个 RQAlpha 可以连接该 redis 获取实时盘口数据，就不需要重复获取数据。详情参考文档 <a class="reference external" href="https://github.com/ricequant/rqalpha/blob/master/rqalpha/mod/rqalpha_mod_sys_stock_realtime/README.rst">sys stock realtime mod README</a></li>
<li>解决期货策略持仓到交割导致可用资金计算不准确的问题</li>
<li>解决 <cite>–plot</cite> 时候会报错退出的问题</li>
</ul>
</div>
<div class="section" id="id8">
<h2>2.2.2<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加 <code class="code docutils literal"><span class="pre">run_file</span></code> | <code class="code docutils literal"><span class="pre">run_code</span></code> | <code class="code docutils literal"><span class="pre">run_func</span></code> API, 详情请参见 <a class="reference external" href="http://rqalpha.io/zh_CN/latest/intro/run_algorithm.html">多种方式运行策略</a></li>
<li>Breaking Change: 更改 <code class="code docutils literal"><span class="pre">AbstractStrategyLoader:load</span></code> 函数的传入参数，现在不需要 <code class="code docutils literal"><span class="pre">strategy</span></code> 了。</li>
<li>增加 <code class="code docutils literal"><span class="pre">UserFuncStrategyLoader</span></code> 类</li>
<li>根据 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/116">Issue 116</a> 增加如下内容:<ul>
<li><code class="code docutils literal"><span class="pre">POSITION_EFFECT</span></code> 增加 <code class="code docutils literal"><span class="pre">CLOSE_TODAY</span></code> 类型</li>
<li>增加调仓函数 <code class="code docutils literal"><span class="pre">order(order_book_id,</span> <span class="pre">quantity,</span> <span class="pre">price=None)</span></code> API<ul>
<li>如果不传入 price 则认为执行的是 MarketOrder 类型订单，否则下 LimitOrder 订单</li>
<li>期货<ul>
<li>quantity &gt; 0: 往 BUY 方向调仓 quantity 手</li>
<li>quantity &lt; 0: 往 SELL 方向调仓 quantity 手</li>
</ul>
</li>
<li>股票<ul>
<li>相当于 order_shares 函数</li>
</ul>
</li>
</ul>
</li>
<li>增加调仓函数 <code class="code docutils literal"><span class="pre">order_to(order_book_id,</span> <span class="pre">quantity,</span> <span class="pre">price=None)</span></code> API<ul>
<li>基本逻辑和 <code class="code docutils literal"><span class="pre">order</span></code> 函数一致</li>
<li>区别在于 quantity 表示调仓对应的最终仓位</li>
</ul>
</li>
<li>现有所有下单函数，增加 <cite>price</cite> option，具体行为和 <code class="code docutils literal"><span class="pre">order</span></code> | <code class="code docutils literal"><span class="pre">order_to</span></code> 一致</li>
</ul>
</li>
<li>Fix bug in <code class="code docutils literal"><span class="pre">all_instruments</span></code> <a class="reference external" href="https://github.com/ricequant/rqalpha/pull/123">PR 123</a></li>
<li>Fix “运行不满一天的情况下 sys_analyser 报 KeyError” <a class="reference external" href="https://github.com/ricequant/rqalpha/pull/118">PR 118</a></li>
<li>sys_analyser 生成 report 对应的字段进行调整，具体调整内容请查看 commit <a class="reference external" href="https://github.com/ricequant/rqalpha/commit/f6e4c24fde2f086cc09b45b2cc4d2cfe0cd9d19f">d9d19f</a></li>
</ul>
</div>
<div class="section" id="id11">
<h2>2.2.0<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加 <code class="code docutils literal"><span class="pre">order</span></code> 和 <code class="code docutils literal"><span class="pre">order_to</span></code> 高阶下单函数</li>
<li>更新数据源，现在使用原始数据和复权因子的方式进行回测</li>
<li>不再使用 <cite>ruamel.yaml</cite> 该库在某些情况下无法正确解析 yml 配置文件</li>
<li>解决 <cite>six</cite> 库依赖多次引用导致安装出错的问题</li>
<li>解决 <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">run</span></code> 的时候指定 <code class="code docutils literal"><span class="pre">-st</span></code> | <code class="code docutils literal"><span class="pre">--kind</span></code> 时报错的问题</li>
<li><code class="code docutils literal"><span class="pre">--security</span></code> / <code class="code docutils literal"><span class="pre">-st</span></code> 现在支持多种模式，可以使用 <code class="code docutils literal"><span class="pre">-st</span> <span class="pre">stock</span> <span class="pre">-st</span> <span class="pre">future</span></code> 也可以使用 <code class="code docutils literal"><span class="pre">-st</span> <span class="pre">stock_future</span></code> 来设置security</li>
<li>更新 BarDictPriceBoard <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/115">Issue 115</a></li>
<li>解决 <code class="code docutils literal"><span class="pre">print(context.portfolio)</span></code> 时因为调用了 <cite>abandon property</cite> 会报 warning 的问题 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/114">Issue 114</a></li>
<li>解决 <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">mod</span> <span class="pre">install</span> <span class="pre">xx</span></code> 不存在的 Mod 也会导致 mod_config.yml 更新的问题 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/111">Issue 111</a></li>
<li>解决 <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">plot</span></code> 无法画图的问题 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/109">Issue 109</a></li>
</ul>
</div>
<div class="section" id="id12">
<h2>2.1.4<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>解决 history_bars 在 before_trading 获取的是未来数据的问题</li>
<li>解决 before_trading 获取结算价是当前交易日结算价的问题</li>
<li>增加 RQAlpha 向前兼容(0.3.x) <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/100">Issue 100</a></li>
<li>期货增加强平机制: 及当前账户权益&lt;=0时，清空仓位，资金置0 <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/108">Issue 108</a></li>
<li>解决回测时只有一个交易日时，只有回测数据显示的问题</li>
</ul>
</div>
<div class="section" id="id13">
<h2>2.1.3<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/101">Issue 101</a></li>
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/105">Issue 105</a></li>
<li>解决运行 RQAlpha 时缺少 <cite>six</cite> | <cite>requests</cite> 库依赖的问题</li>
<li>解决安装RQAlpha时在某些情况下报错的问题</li>
<li>解决第三方 Mod 安装后配置文件路径有误的问题</li>
<li>现在可以通过 <cite>rqalpha mod install -e .</cite> 的方式来安装依赖 Mod 了</li>
<li>现在运行策略时会检测当前目录是否存在 <cite>config.yml</cite> 或者 <cite>config.json</cite> 来作为配置文件</li>
<li>解决股票下单就存在 <cite>position</cite> 的问题，现在只有成交后才会产生 <cite>position</cite> 了。</li>
<li>修复 <cite>portfolio</cite> 和 <cite>future_account</cite> 计算逻辑的一些问题</li>
<li>修复 <cite>transaction_cost</cite> 在某个 position 清空以后计算不准确的问题</li>
<li>在信号模式下 <cite>price_limit</cite> 表示是否输出涨跌停买入/卖出的报警信息，但不会阻止其买入/卖出</li>
</ul>
</div>
<div class="section" id="id14">
<h2>2.1.2<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>提供 <code class="code docutils literal"><span class="pre">from</span> <span class="pre">rqalpha</span> <span class="pre">import</span> <span class="pre">cli</span></code> 方便第三方 Mod 扩展 <cite>rqalpha</cite> command</li>
<li><code class="code docutils literal"><span class="pre">history_bars</span></code> 增加 <code class="code docutils literal"><span class="pre">include_now</span></code> option</li>
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/90">Issue 90</a></li>
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/94">Issue 94</a></li>
</ul>
</div>
<div class="section" id="id15">
<h2>2.1.0<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/87">Issue 87</a></li>
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/pull/89">Issue 89</a></li>
<li>Fix 无法通过 <code class="code docutils literal"><span class="pre">env.config.mod</span></code> 获取全部 <cite>mod</cite> 的配置信息</li>
<li>增加 <code class="code docutils literal"><span class="pre">context.config</span></code> 来获取配置信息</li>
<li>提供 <code class="code docutils literal"><span class="pre">from</span> <span class="pre">rqalpha</span> <span class="pre">import</span> <span class="pre">export_as_api</span></code> 接口，方便扩展自定义 API</li>
</ul>
</div>
<div class="section" id="id16">
<h2>2.0.9<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/79">Issue 79</a></li>
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/82">Issue 82</a></li>
<li>Fix <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">cmd</span></code> 失效</li>
</ul>
</div>
<div class="section" id="id17">
<h2>2.0.8<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/81">Issue 81</a></li>
<li>解决 <cite>mod_config.yml</cite> 文件解析出错以后，所有的命令报错的问题</li>
<li>默认在 Python 2.x 下 <cite>sys.setdefaultencoding(“utf-8”)</cite></li>
<li>优化 <cite>UNIVERSE_CHANGED</cite> 事件，现在只有在universe真正变化时才触发</li>
</ul>
</div>
<div class="section" id="id18">
<h2>2.0.7<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Fix <a class="reference external" href="https://github.com/ricequant/rqalpha/issues/78">Issue 78</a></li>
<li><cite>is_st_stock</cite> | <cite>is_suspended</cite> 支持 <cite>count</cite> 参数</li>
<li>解决大量 Python 2.x 下中文乱码问题</li>
</ul>
</div>
<div class="section" id="id19">
<h2>2.0.6<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>解决在 Python 2.x 下安装 RQAlpha 提示 <cite>requirements-py2.txt Not Found</cite> 的问题</li>
<li>解决 <cite>Benchmark</cite> 无法显示的问题</li>
<li>解决 <cite>rqalpha mod list</cite> 显示不正确的问题</li>
<li>现在可以通过配置 <cite>base.extra_vars</cite> 向策略中预定义变量了。用法如下:</li>
</ul>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rqalpha</span> <span class="k">import</span> <span class="n">run</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;strategy_file&quot;</span><span class="p">:</span> <span class="s2">&quot;strategy.py&quot;</span><span class="p">,</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-06-01&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-07-01&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stock_starting_cash&quot;</span><span class="p">:</span><span class="mi">100000</span><span class="p">,</span>
    <span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s1">&#39;000300.XSHG&#39;</span>
  <span class="p">},</span>
  <span class="s2">&quot;extra&quot;</span><span class="p">:{</span>
    <span class="s2">&quot;context_vars&quot;</span><span class="p">:{</span>
      <span class="s2">&quot;short&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;middle&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
      <span class="s2">&quot;long&quot;</span><span class="p">:</span><span class="mi">21</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">result_dict</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># 以下是策略代码:</span>

<span class="k">def</span> <span class="nf">handle_bar</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">short</span><span class="p">)</span>    <span class="c1"># 5</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">middle</span><span class="p">)</span>   <span class="c1"># 10</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>     <span class="c1"># 21</span>
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h2>2.0.1<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>修改配置的读取方式，不再从 <cite>~/.rqalpha/config.yml</cite> 读取自定义配置信息，而是默认从当前路径读取 <cite>config.yml</cite>，如果没找到，则会读取系统默认配置信息</li>
<li>现在不再对自定义信息进行版本检查</li>
<li><code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">generate_config</span></code> 现在会生成包含所有默认系统配置信息的 <cite>config.yml</cite> 文件。</li>
<li><code class="code docutils literal"><span class="pre">RUN_TYPE</span></code> 增加 <code class="code docutils literal"><span class="pre">LIVE_TRADING</span></code></li>
<li>修复 <code class="code docutils literal"><span class="pre">history_bars</span></code> 获取日期错误产生的问题</li>
<li>修复执行 <code class="code docutils literal"><span class="pre">context.run_info</span></code> 会报错的问题</li>
<li>修复持久化报错的问题</li>
<li>增加 Order Persist 相关内容</li>
</ul>
</div>
<div class="section" id="id21">
<h2>2.0.0<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h2>
<p>2.0.0 详细修改内容请访问：<a class="reference external" href="https://github.com/ricequant/rqalpha/issues/65">RQAlpha 2.0.0</a></p>
<p><strong>Portfolio/Account/Position 相关</strong></p>
<ul class="simple">
<li>重新定义了 <code class="code docutils literal"><span class="pre">Portfolio</span></code>, <code class="code docutils literal"><span class="pre">Account</span></code> 和 <code class="code docutils literal"><span class="pre">Position</span></code> 的角色和关系</li>
<li>删除大部分累计计算的属性，重新实现股票和期货的计算逻辑</li>
<li>现在只有在 <code class="code docutils literal"><span class="pre">Portfolio</span></code> 层级进行净值/份额的计算，Account级别不再进行净值/份额/收益/相关的计算</li>
<li>账户的恢复和初始化现在只需要 <code class="code docutils literal"><span class="pre">total_cash</span></code>, <code class="code docutils literal"><span class="pre">positions</span></code> 和 <code class="code docutils literal"><span class="pre">backward_trade_set</span></code> 即可完成</li>
<li>精简 <code class="code docutils literal"><span class="pre">Position</span></code> 的初始化，可以从 <code class="code docutils literal"><span class="pre">real_broker</span></code> 直接进行恢复</li>
<li><code class="code docutils literal"><span class="pre">Account</span></code> 提供 <code class="code docutils literal"><span class="pre">fast_forward</span></code> 函数，账户现在可以从任意时刻通过 <code class="code docutils literal"><span class="pre">orders</span></code> 和 <code class="code docutils literal"><span class="pre">trades</span></code> 快速前进至最新状态</li>
<li>如果存在 Benchmark， 则创建一个 <code class="code docutils literal"><span class="pre">benchmark_portfolio</span></code>, 其包含一个 <code class="code docutils literal"><span class="pre">benchmark_account</span></code></li>
<li>策略在调用 <code class="code docutils literal"><span class="pre">context.portfolio.positions[some_security]</span></code> 时候，如果 position 不存在，不再每次都创建临时仓位，而是会缓存，从而提高回测速度和性能</li>
<li>不再使用 <code class="code docutils literal"><span class="pre">clone</span></code> 方法</li>
<li>不再使用 <code class="code docutils literal"><span class="pre">PortfolioProxy</span></code> 和 <code class="code docutils literal"><span class="pre">PositionProxy</span></code></li>
</ul>
<p><strong>Event 相关</strong></p>
<ul class="simple">
<li>规范 Event 的生成和相应逻辑, 使用 Event object 来替换原来的 Enum</li>
<li>抽离事件执行相关逻辑为 <code class="code docutils literal"><span class="pre">Executor</span></code> 模块</li>
</ul>
<p><strong>Mod 相关</strong></p>
<ul class="simple">
<li>规范化 Mod 命名规则，需要以 <cite>rqalpha_mod_xxx</cite> 作为 Mod 依赖库命名</li>
<li>抽离 <code class="code docutils literal"><span class="pre">slippage</span></code> 相关业务逻辑至 <code class="code docutils literal"><span class="pre">simulation</span> <span class="pre">mod</span></code></li>
<li>抽离 <code class="code docutils literal"><span class="pre">commission</span></code> 相关业务逻辑至 <code class="code docutils literal"><span class="pre">simulation</span> <span class="pre">mod</span></code></li>
<li>抽离 <code class="code docutils literal"><span class="pre">tax</span></code> 相关业务逻辑至 <code class="code docutils literal"><span class="pre">simulation</span> <span class="pre">mod</span></code></li>
<li><cite>rqalpha mod list</cite> 命令现在可以格式化显示 Mod 当前的状态了</li>
</ul>
<p><strong>Environment 和 ExecutionContext 相关</strong></p>
<ul class="simple">
<li>现在 <code class="code docutils literal"><span class="pre">ExecutionContext</span></code> 只负责上下文相关的内容，不再可以通过 <code class="code docutils literal"><span class="pre">ExecutionContext</span></code> 访问其他成员变量。</li>
<li>扩展了 <code class="code docutils literal"><span class="pre">Environment</span></code> 的功能，RQAlpha 及 Mod 均可以直接通过 <code class="code docutils literal"><span class="pre">Environment.get_instance()</span></code> 来获取到环境中核心模块的引用</li>
<li><code class="code docutils literal"><span class="pre">Environment</span></code> 还提供了很多常用的方法，具体请直接参考代码</li>
</ul>
<p><strong>配置及参数相关</strong></p>
<ul class="simple">
<li>重构了配置相关的内容，<cite>~/.rqalpha/config.yml</cite> 现在类似于 Sublime/Atom 的用户配置文件，用于覆盖默认配置信息，因此只需要增加自定义配置项即可，不需要全部的配置内容都存在</li>
<li>将Mod自己的默认配置从配置文件中删除，放在Mod中自行管理和维护</li>
<li>独立存在 <cite>~/.rqalpha/.mod_conifg.yml</cite>, 提供 <cite>rqalpha mod install/uninstall/enable/disable/list</cite> 命令，RQAlpha 会通过该配置文件来对Mod进行管理。</li>
<li>抽离 <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">run</span></code> 的参数，将其中属于 <cite>Mod</cite> 的参数全部删除，取代之为Mod提供了参数注入机制，所以现在 <cite>Mod</cite> 可以自行决定是否要注入参数或者命令来扩展 RQAlpha 的功能</li>
<li>提供了 <code class="code docutils literal"><span class="pre">rqalpha-cmd</span></code> 命令，<cite>Mod</cite> 推荐在该命令下注入自己的命令来实现功能扩展</li>
<li>不再使用 <cite>–strategy-type</cite>， 改为使用 <cite>–security</cite> 选项</li>
<li><cite>–output-file</cite> | <cite>–report</cite> | <cite>–plot</cite> | <cite>–plot-save`参数 转移至 `sys_analyser</cite> Mod 中</li>
<li><cite>plot</cite> | <cite>report</cite> 命令，转移至 <cite>sys_analyser</cite> Mod 中</li>
<li><cite>–signal</cite> | <cite>–slippage</cite> | <cite>–commission-multiplier</cite> | <cite>–matching-type</cite> | <cite>–rid</cite> 转移至 <cite>sys_simulation</cite> Mod 中</li>
</ul>
<p><strong>Risk 计算</strong></p>
<ul class="simple">
<li>修复 <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-factors">tracking error</a> 计算错误</li>
<li>修改 <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-risk-adjusted-returns">sharpe</a> , <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-risk-adjusted-returns">sortino</a> , <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-risk-adjusted-returns">information ratio</a> , <a class="reference external" href="https://www.ricequant.com/api/python/chn#backtest-results-returns">alpha</a> 计算逻辑。参考 <a class="reference external" href="https://gladmainnew.morningstar.com/directhelp/Methodology_StDev_Sharpe.pdf">晨星</a> 的方法, 先计算单日级别指标, 再进行年化。与原本直接基于年化值计算相比, 在分析时间较短的情况下, 新的指标计算结果会系统性低于原指标结果。</li>
<li>引入单日无风险利率作为中间变量计算上述指标。单日无风险利率为通过 <a class="reference external" href="http://yield.chinabond.com.cn/cbweb-mn/yield_main">中国债券信息网</a> 获取得到对应期限的年化国债到期收益率除以244得到</li>
<li>修改指标说明若干</li>
</ul>
<p><strong>其他</strong></p>
<ul class="simple">
<li>修改了 <code class="code docutils literal"><span class="pre">Order</span></code> 和 <code class="code docutils literal"><span class="pre">Trade</span></code> 的字段和函数，使其更通用</li>
<li>为 <code class="code docutils literal"><span class="pre">RqAttrDict</span></code> 类增加 <code class="code docutils literal"><span class="pre">update</span></code> 方法，现在支持动态更新了</li>
<li><code class="code docutils literal"><span class="pre">arg_checker</span></code> 增加 <code class="code docutils literal"><span class="pre">is_greater_or_equal_than</span></code> 和 <code class="code docutils literal"><span class="pre">is_less_or_equal_than</span></code> 函数</li>
<li>删除 <code class="code docutils literal"><span class="pre">DEFAULT_FUTURE_INFO</span></code> 变量，现在可以直接通过 <code class="code docutils literal"><span class="pre">data_proxy</span></code> 获取相关数据</li>
<li>通过 <a class="reference external" href="https://github.com/Qix-/better-exceptions">better_exceptions</a> 提供更好的错误堆栈提示体验</li>
<li>对字符串的处理进行了优化，现在可以正确在 Python2.x/3.x 下显示中文了</li>
<li>修复 <code class="code docutils literal"><span class="pre">update_bundle</span></code> 直接在代码中调用会报错的问题</li>
<li>增加对于下单量为0的订单过滤，不再会创建订单，也不再会输出警报日志</li>
<li>增加 <code class="code docutils literal"><span class="pre">is_suspended</span></code> 和 <code class="code docutils literal"><span class="pre">is_st_stock</span></code> API 的支持</li>
</ul>
</div>
<div class="section" id="id24">
<h2>0.3.14<a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>Hotfix <code class="code docutils literal"><span class="pre">UnboundLocalError:</span> <span class="pre">local</span> <span class="pre">variable</span> <span class="pre">'signature'</span> <span class="pre">referenced</span> <span class="pre">before</span> <span class="pre">assignment</span></code></li>
</ul>
</div>
<div class="section" id="id25">
<h2>0.3.13<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加股票裸做空的配置参数 <code class="code docutils literal"><span class="pre">--short-stock</span></code></li>
<li><code class="code docutils literal"><span class="pre">POSITION_EFFECT</span></code> 增加 <code class="code docutils literal"><span class="pre">CLOSE_TODAY</span></code></li>
<li><code class="code docutils literal"><span class="pre">ExecutionContext</span></code> 增加 <code class="code docutils literal"><span class="pre">get_current_close_price</span></code> <code class="code docutils literal"><span class="pre">get_future_commission_info</span></code>  <code class="code docutils literal"><span class="pre">get_future_margin</span></code> <code class="code docutils literal"><span class="pre">get_future_info</span></code> 函数</li>
<li>增加 <code class="code docutils literal"><span class="pre">RQInvalidArgument</span></code> 来处理用户策略代码异常的问题</li>
<li>现在可以正确提示期货主力连续合约和指数连续合约在回测和模拟中的报错信息了</li>
<li>现在以 <code class="code docutils literal"><span class="pre">handle_tick(context,</span> <span class="pre">tick)</span></code> 的方式支持tick级别的API支持(未来可能会修改)</li>
<li>现在回测时的 <code class="code docutils literal"><span class="pre">before_trading</span></code> 函数输出的时间提前到开盘前半小时</li>
</ul>
</div>
<div class="section" id="id26">
<h2>0.3.12<a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>优化 <cite>setup.py</cite> 脚本，只有在 python 2 环境下才安装兼容性依赖库</li>
<li>增加 <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">install/uninstall/list/enable/disable</span></code> 命令</li>
<li>增加 <code class="code docutils literal"><span class="pre">EVENT.POST_SYSTEM_RESTORED</span></code> 事件</li>
<li>增加 净值和份额的支持，现在的收益和Analyser的计算都是基于净值了。</li>
<li>在 AnalyserMod 输出的 Trade 中增加 <code class="code docutils literal"><span class="pre">side</span></code> 和 <code class="code docutils literal"><span class="pre">position_effect</span></code></li>
<li>修复 <code class="code docutils literal"><span class="pre">total_orders</span></code> 计算错误</li>
<li>修复 <code class="code docutils literal"><span class="pre">inpsect.signature</span></code> 在 python 2.x 报错的问题。</li>
</ul>
</div>
<div class="section" id="id27">
<h2>0.3.11<a class="headerlink" href="#id27" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>更新本地化翻译，修改系统提示，支持多语言</li>
<li>增加 <code class="code docutils literal"><span class="pre">--locale</span></code> 默认为 <code class="code docutils literal"><span class="pre">cn</span></code> (中文), 支持 <code class="code docutils literal"><span class="pre">cn</span> <span class="pre">|</span> <span class="pre">en</span></code> (中文 | 英文)</li>
<li>修复 <code class="code docutils literal"><span class="pre">main.run</span></code> 返回值中 <code class="code docutils literal"><span class="pre">stock_position</span></code> 为 <code class="code docutils literal"><span class="pre">None</span></code> 的问题</li>
<li>修复 Windows Python 2.7 下中文显示乱码的问题</li>
</ul>
</div>
<div class="section" id="id28">
<h2>0.3.10<a class="headerlink" href="#id28" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加 <code class="code docutils literal"><span class="pre">config.yml</span></code> 的版本号检查及相关流程</li>
<li>增加 <code class="code docutils literal"><span class="pre">plot</span></code> 关于中文字体的校验，如果系统没有中文字体，则显示英文字段</li>
<li>修正 <code class="code docutils literal"><span class="pre">Benchmark</span></code> 在不设置时某些情况下会导致运行失败的错误</li>
<li>修正 <code class="code docutils literal"><span class="pre">inspect.unwrap</span></code> 在 Python 2.7 下不支持的兼容性问题</li>
<li>修正 <code class="code docutils literal"><span class="pre">numpy</span></code> 在某些平台下没有 <cite>float128</cite> 引起的报错问题</li>
</ul>
</div>
<div class="section" id="id29">
<h2>0.3.9<a class="headerlink" href="#id29" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加 <code class="code docutils literal"><span class="pre">--disable-user-system-log</span></code> 参数，可以独立关闭回测过程中因策略而产生的系统日志</li>
<li><code class="code docutils literal"><span class="pre">--log-level</span></code> 现在可以正确区分不同类型的日志，同时增加 <code class="code docutils literal"><span class="pre">none</span></code> 类型，用来关闭全部日志信息。</li>
<li>在不指定配置文件的情况下，默认会调用 <code class="code docutils literal"><span class="pre">~/.rqalpha/config.yml</span></code> 文件</li>
<li>支持 <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">generate_config</span></code> 命令来获取默认配置文件</li>
<li>指定策略类型不再使用 <code class="code docutils literal"><span class="pre">--kind</span></code> 参数，替换为 <code class="code docutils literal"><span class="pre">--strategy-type</span></code> 和配置文件呼应</li>
<li>重构 <code class="code docutils literal"><span class="pre">events.py</span></code>，现在可以更好的支持基于事件的模块编写了</li>
<li>将风险指标计算独立成 <code class="code docutils literal"><span class="pre">analyser</span></code> Mod</li>
<li>将事前风控相关内容独立成 <code class="code docutils literal"><span class="pre">risk_manager</span></code> Mod</li>
<li>将 <cite>回测</cite> 和 <cite>实盘模拟</cite> 相关功能独立成 <code class="code docutils literal"><span class="pre">simulation</span></code> Mod</li>
</ul>
</div>
<div class="section" id="id30">
<h2>0.3.8<a class="headerlink" href="#id30" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加几个 technical analysis 的 examples 和自动化测试</li>
<li>修复一些在 Python 2 下运行的 bug</li>
</ul>
</div>
<div class="section" id="id31">
<h2>0.3.7<a class="headerlink" href="#id31" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加 <code class="code docutils literal"><span class="pre">-mc</span></code> / <code class="code docutils literal"><span class="pre">--mod-config</span></code> 参数来传递参数到 mod 中</li>
<li>增加了 simple_stock_realtime_trade, progressive_output_csv，funcat_api 几个 DEMO mod 供开发者参考开发自己的 mod</li>
<li><code class="code docutils literal"><span class="pre">update_bundle</span></code> 移到 <code class="code docutils literal"><span class="pre">main.py</span></code> 中，方便直接从代码中调用 <code class="code docutils literal"><span class="pre">update_bundle</span></code></li>
<li>增加了一些自动化的测试用例</li>
</ul>
</div>
<div class="section" id="id32">
<h2>0.3.6<a class="headerlink" href="#id32" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>support auto test with Travis [python 2.7 3.4 3.5 3.6]</li>
<li><code class="code docutils literal"><span class="pre">rqalpha.run</span></code> 现在支持直接传入 <code class="code docutils literal"><span class="pre">source_code</span></code> 了</li>
<li>支持 <code class="code docutils literal"><span class="pre">rqalpha.update_bundle</span></code> 函数</li>
</ul>
</div>
<div class="section" id="id33">
<h2>0.3.5<a class="headerlink" href="#id33" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加 <code class="code docutils literal"><span class="pre">from</span> <span class="pre">rqalpha</span> <span class="pre">import</span> <span class="pre">run</span></code> 接口，现在可以很方便的直接在程序中调用RQAlpha 回测了。</li>
</ul>
</div>
<div class="section" id="id34">
<h2>0.3.4<a class="headerlink" href="#id34" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>本地化模块更具有扩展性</li>
<li>修改 <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">update_bundle</span></code> 的目录结构，现在是在指定目录下生成一个 bundle 文件，而不再会直接删除当前文件夹内容了。</li>
</ul>
</div>
<div class="section" id="id35">
<h2>0.3.3<a class="headerlink" href="#id35" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>解决 <code class="code docutils literal"><span class="pre">rqalpha</span> <span class="pre">examples</span> <span class="pre">-d</span> <span class="pre">.</span></code> 无样例策略生成的问题</li>
</ul>
</div>
<div class="section" id="id36">
<h2>0.3.2<a class="headerlink" href="#id36" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>解决 Windows 10 下 matplotlib 中文字体显示乱码的问题</li>
<li>解决 Windows 下 set_locale error 的问题</li>
</ul>
</div>
<div class="section" id="id37">
<h2>0.3.1<a class="headerlink" href="#id37" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加 Python 2 的支持</li>
</ul>
</div>
<div class="section" id="id38">
<h2>0.3.0<a class="headerlink" href="#id38" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>支持多周期回测扩展(虽然只有日线数据，但是结构上是支持不同周期的回测和实盘的)</li>
<li>支持期货策略</li>
<li>支持混合策略(股票和期货混合)</li>
<li>支持多种参数配置方式</li>
<li>抽离接口层，数据源、事件源、撮合引擎、下单模块全部可以替换或扩展。</li>
<li>完善事件定义，采取 pub/sub 模式，可以非常简答的在 RQAlpha 中添加 hook。</li>
<li>增加 Mod 机制，极大的增加了 RQAlpha 的扩展性，使其可以轻松完成程序化交易过程中所产生的的特定需求。</li>
</ul>
</div>
<div class="section" id="id39">
<h2>0.0.53<a class="headerlink" href="#id39" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>完善了回测结果显示</li>
<li>修正了 Risk 计算和 Benchmark 计算</li>
</ul>
</div>
<div class="section" id="id40">
<h2>0.0.20<a class="headerlink" href="#id40" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加会回测进度显示开关</li>
<li>完善了回测结果显示</li>
</ul>
</div>
<div class="section" id="id41">
<h2>0.0.19<a class="headerlink" href="#id41" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>在 <code class="code docutils literal"><span class="pre">handle_bar</span></code> 前用当前的数据更新 portfolio 和 position，因为 ricequant.com 是这样做的。</li>
</ul>
</div>
<div class="section" id="id42">
<h2>0.0.18<a class="headerlink" href="#id42" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>修复了分红计算</li>
</ul>
</div>
<div class="section" id="id43">
<h2>0.0.16<a class="headerlink" href="#id43" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>用户可以通过 context 设置 slippage/commission/benchmark</li>
<li>增加了 scheduler</li>
</ul>
</div>
<div class="section" id="id44">
<h2>0.0.15<a class="headerlink" href="#id44" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>修复 history 在 before_trading 调用</li>
<li>增加 api 的 phase 检查</li>
</ul>
</div>
<div class="section" id="id45">
<h2>0.0.14<a class="headerlink" href="#id45" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>修改支持 python2</li>
</ul>
</div>
<div class="section" id="id46">
<h2>0.0.12<a class="headerlink" href="#id46" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>修正了 Risk 计算，使用合理的年化收益计算方法</li>
<li>格式化代码符合 pep8</li>
<li>更新 requirements.txt</li>
</ul>
</div>
<div class="section" id="id47">
<h2>0.0.9<a class="headerlink" href="#id47" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加了数据下载</li>
<li>修正了 Risk 计算</li>
<li>增加了 instrument</li>
<li>增加了 position 的 <code class="code docutils literal"><span class="pre">market_value</span></code> 和 <code class="code docutils literal"><span class="pre">value_percent</span></code></li>
</ul>
</div>
<div class="section" id="id48">
<h2>0.0.2<a class="headerlink" href="#id48" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>增加了日线回测</li>
<li>去掉了涨跌停检查</li>
<li>增加了分红处理</li>
<li>运行参数如下:</li>
</ul>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="c1"># 生成sample策略</span>
<span class="n">rqalpha</span> <span class="n">generate_examples</span> <span class="o">-</span><span class="n">d</span> <span class="o">./</span>

<span class="c1"># 运行回测</span>
<span class="n">rqalpha</span> <span class="n">run</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">simple_macd</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">s</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="o">-</span><span class="n">e</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">a</span><span class="o">.</span><span class="n">pkl</span>
</pre></div>
</div>
</div>
<div class="section" id="id49">
<h2>0.0.1<a class="headerlink" href="#id49" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li>搭建基本的框架，增加基本的 unittest</li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="development/data_source.html" class="btn btn-neutral" title="扩展数据源" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, MooQuant.
      最后更新于 9月 13, 2017.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
    console.log("Powered By MooQuant.");
</script>


</body>
</html>